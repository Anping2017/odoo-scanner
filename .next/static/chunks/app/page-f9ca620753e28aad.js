(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{1965:function(e,t,n){Promise.resolve().then(n.bind(n,1002))},1002:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return s}});var o=n(7437),l=n(2265);let i=[{key:"moboplus.co.nz",label:"https://moboplus.co.nz",url:"https://moboplus.co.nz",db:"odoo"},{key:"repair.raytech.co.nz",label:"https://repair.raytech.co.nz",url:"https://repair.raytech.co.nz",db:"db-raytech-repair"}];function r(e){let{initialKey:t,onChange:n}=e,[r,a]=(0,l.useState)(t||i[0].key);return(0,l.useEffect)(()=>{n(i.find(e=>e.key===r)||i[0])},[r,n]),(0,o.jsxs)("label",{style:{display:"block",marginBottom:10},children:[(0,o.jsx)("div",{style:{fontSize:12,color:"#6b7280",marginBottom:4},children:"选择域名"}),(0,o.jsx)("select",{value:r,onChange:e=>a(e.target.value),style:{width:"100%",padding:"10px 12px",border:"1px solid #e5e7eb",borderRadius:8,outline:"none"},children:i.map(e=>(0,o.jsx)("option",{value:e.key,children:e.label},e.key))})]})}function a(e){let{show:t=!1,required:n=!1,initialId:i,onChange:r}=e,[a,s]=(0,l.useState)(i?String(i):""),[d,c]=(0,l.useState)(!1);return((0,l.useEffect)(()=>{r(a?Number(a):void 0)},[a,r]),t)?(0,o.jsxs)("fieldset",{style:{border:"1px solid #e5e7eb",padding:12,borderRadius:8,marginTop:12},children:[(0,o.jsx)("legend",{style:{padding:"0 6px"},children:"选择公司（moboplus.co.nz 必选）"}),[1,2,3,4].map(e=>(0,o.jsxs)("label",{style:{display:"inline-flex",alignItems:"center",marginRight:16},children:[(0,o.jsx)("input",{type:"radio",name:"company",value:e,checked:a===String(e),onChange:e=>s(e.target.value),onBlur:()=>c(!0),style:{marginRight:6}}),e]},e)),n&&d&&!a?(0,o.jsx)("div",{style:{color:"#dc2626",marginTop:8,fontSize:12},children:"请先选择公司 ID"}):null]}):null}function s(){let[e,t]=(0,l.useState)(""),[n,i]=(0,l.useState)(""),[s,d]=(0,l.useState)(!0),[c,u]=(0,l.useState)(null),[p,h]=(0,l.useState)(void 0),[b,g]=(0,l.useState)(!1),[y,m]=(0,l.useState)(""),x=(null==c?void 0:c.key)==="moboplus.co.nz",f=(0,l.useMemo)(()=>!!e&&!!n&&!!c&&(!x||!!p)&&!b,[e,n,c,x,p,b]);async function j(t){if(t.preventDefault(),m(""),f&&c){g(!0);try{let t=await fetch("/api/login",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({login:e,password:n,remember:s,companyId:x?p:void 0,baseUrl:c.url,dbName:c.db})}),o=await t.json().catch(()=>({}));if(!t.ok)throw Error((null==o?void 0:o.error)||"登录失败");window.location.href="/scan"}catch(e){m((null==e?void 0:e.message)||"登录失败")}finally{g(!1)}}}return(0,o.jsx)("div",{style:{minHeight:"100dvh",display:"grid",placeItems:"center",padding:20},children:(0,o.jsxs)("form",{onSubmit:j,style:{width:"100%",maxWidth:420,border:"1px solid #e5e7eb",borderRadius:12,padding:20,boxShadow:"0 2px 8px rgba(0,0,0,0.06)",background:"#fff"},children:[(0,o.jsx)("h1",{style:{fontSize:20,marginBottom:16},children:"登录 Odoo"}),(0,o.jsx)(r,{onChange:u}),(0,o.jsxs)("label",{style:{display:"block",marginBottom:10},children:[(0,o.jsx)("div",{style:{fontSize:12,color:"#6b7280",marginBottom:4},children:"账号"}),(0,o.jsx)("input",{value:e,onChange:e=>t(e.target.value),required:!0,autoComplete:"username",placeholder:"登录邮箱/账号",style:{width:"100%",padding:"10px 12px",border:"1px solid #e5e7eb",borderRadius:8,outline:"none"}})]}),(0,o.jsxs)("label",{style:{display:"block",marginBottom:10},children:[(0,o.jsx)("div",{style:{fontSize:12,color:"#6b7280",marginBottom:4},children:"密码"}),(0,o.jsx)("input",{type:"password",value:n,onChange:e=>i(e.target.value),required:!0,autoComplete:"current-password",placeholder:"密码",style:{width:"100%",padding:"10px 12px",border:"1px solid #e5e7eb",borderRadius:8,outline:"none"}})]}),(0,o.jsx)(a,{show:x,required:x,onChange:h}),(0,o.jsxs)("label",{style:{display:"flex",alignItems:"center",marginTop:12},children:[(0,o.jsx)("input",{type:"checkbox",checked:s,onChange:e=>d(e.target.checked),style:{marginRight:8}}),"保持登录 30 天"]}),y?(0,o.jsx)("div",{style:{color:"#dc2626",marginTop:12,fontSize:13},children:y}):null,(0,o.jsx)("button",{type:"submit",disabled:!f,style:{marginTop:16,width:"100%",padding:"12px 14px",borderRadius:10,border:"none",background:f?"#111827":"#9ca3af",color:"#fff",cursor:f?"pointer":"not-allowed",fontWeight:600,letterSpacing:.3},children:b?"登录中…":"登录"})]})})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=1965)}),_N_E=e.O()}]);