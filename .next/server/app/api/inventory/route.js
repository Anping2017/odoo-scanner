"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/inventory/route";
exports.ids = ["app/api/inventory/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Finventory%2Froute&page=%2Fapi%2Finventory%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Finventory%2Froute.ts&appDir=C%3A%5Cworking%5Cnext.js%5Codoo-scanner%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5Cworking%5Cnext.js%5Codoo-scanner&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Finventory%2Froute&page=%2Fapi%2Finventory%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Finventory%2Froute.ts&appDir=C%3A%5Cworking%5Cnext.js%5Codoo-scanner%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5Cworking%5Cnext.js%5Codoo-scanner&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_working_next_js_odoo_scanner_app_api_inventory_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/inventory/route.ts */ \"(rsc)/./app/api/inventory/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/inventory/route\",\n        pathname: \"/api/inventory\",\n        filename: \"route\",\n        bundlePath: \"app/api/inventory/route\"\n    },\n    resolvedPagePath: \"C:\\\\working\\\\next.js\\\\odoo-scanner\\\\app\\\\api\\\\inventory\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_working_next_js_odoo_scanner_app_api_inventory_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/inventory/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZpbnZlbnRvcnklMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmludmVudG9yeSUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmludmVudG9yeSUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDd29ya2luZyU1Q25leHQuanMlNUNvZG9vLXNjYW5uZXIlNUNhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPUMlM0ElNUN3b3JraW5nJTVDbmV4dC5qcyU1Q29kb28tc2Nhbm5lciZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDaUI7QUFDOUY7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9vZG9vLWludmVudG9yeS1zY2FubmVyLz8xYTAzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkM6XFxcXHdvcmtpbmdcXFxcbmV4dC5qc1xcXFxvZG9vLXNjYW5uZXJcXFxcYXBwXFxcXGFwaVxcXFxpbnZlbnRvcnlcXFxccm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2ludmVudG9yeS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2ludmVudG9yeVwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvaW52ZW50b3J5L3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiQzpcXFxcd29ya2luZ1xcXFxuZXh0LmpzXFxcXG9kb28tc2Nhbm5lclxcXFxhcHBcXFxcYXBpXFxcXGludmVudG9yeVxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvaW52ZW50b3J5L3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Finventory%2Froute&page=%2Fapi%2Finventory%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Finventory%2Froute.ts&appDir=C%3A%5Cworking%5Cnext.js%5Codoo-scanner%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5Cworking%5Cnext.js%5Codoo-scanner&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/inventory/route.ts":
/*!************************************!*\
  !*** ./app/api/inventory/route.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_odooPresets__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/odooPresets */ \"(rsc)/./lib/odooPresets.ts\");\n// app/api/inventory/route.ts\n\n\n\n// 通用 RPC 封装\nasync function rpc(url, path, body, cookie) {\n    const res = await fetch(`${url}${path}`, {\n        method: \"POST\",\n        headers: {\n            \"Content-Type\": \"application/json\",\n            cookie\n        },\n        body: JSON.stringify({\n            jsonrpc: \"2.0\",\n            id: Date.now(),\n            method: \"call\",\n            params: body\n        }),\n        cache: \"no-store\"\n    });\n    const data = await res.json().catch(()=>({}));\n    return data;\n}\n// 如果传入的是 view 类型库位，向下找一个 internal 子库位\nasync function resolveEffectiveLocation(base, cookieStr, locId) {\n    const read = await rpc(base, \"/web/dataset/call_kw\", {\n        model: \"stock.location\",\n        method: \"read\",\n        args: [\n            [\n                locId\n            ],\n            [\n                \"id\",\n                \"usage\"\n            ]\n        ],\n        kwargs: {}\n    }, cookieStr);\n    const loc = Array.isArray(read?.result) && read.result[0];\n    if (!loc) throw new Error(`Location ${locId} not found`);\n    if (loc.usage !== \"view\") return locId;\n    const child = await rpc(base, \"/web/dataset/call_kw\", {\n        model: \"stock.location\",\n        method: \"search\",\n        args: [\n            [\n                [\n                    \"location_id\",\n                    \"=\",\n                    locId\n                ],\n                [\n                    \"usage\",\n                    \"=\",\n                    \"internal\"\n                ]\n            ]\n        ],\n        kwargs: {\n            limit: 1\n        }\n    }, cookieStr);\n    if (Array.isArray(child?.result) && child.result.length) return child.result[0];\n    throw new Error(`Location ${locId} is 'view' and has no internal child. Please choose an Internal location (e.g. WH/Stock).`);\n}\n// ✅ 依据“当前公司”自动找默认库位（该公司的 WH/Stock）\nasync function getDefaultLocationForCompany(base, cookieStr, companyId) {\n    // 尝试：拿该公司的仓库 -> lot_stock_id\n    if (companyId) {\n        const whIds = await rpc(base, \"/web/dataset/call_kw\", {\n            model: \"stock.warehouse\",\n            method: \"search\",\n            args: [\n                [\n                    [\n                        \"company_id\",\n                        \"=\",\n                        companyId\n                    ]\n                ]\n            ],\n            kwargs: {\n                limit: 1\n            }\n        }, cookieStr);\n        const wid = whIds?.result?.[0];\n        if (wid) {\n            const wh = await rpc(base, \"/web/dataset/call_kw\", {\n                model: \"stock.warehouse\",\n                method: \"read\",\n                args: [\n                    [\n                        wid\n                    ],\n                    [\n                        \"lot_stock_id\"\n                    ]\n                ],\n                kwargs: {}\n            }, cookieStr);\n            const lot = wh?.result?.[0]?.lot_stock_id?.[0];\n            if (lot) return lot;\n        }\n    }\n    // 兜底：随公司范围找任意一个 internal 库位\n    const domain = [\n        [\n            \"usage\",\n            \"=\",\n            \"internal\"\n        ]\n    ];\n    if (companyId) domain.push([\n        \"company_id\",\n        \"=\",\n        companyId\n    ]);\n    const locIds = await rpc(base, \"/web/dataset/call_kw\", {\n        model: \"stock.location\",\n        method: \"search\",\n        args: [\n            domain\n        ],\n        kwargs: {\n            limit: 1\n        }\n    }, cookieStr);\n    return locIds?.result?.[0];\n}\n// —— GET: 最近库存变动（简版历史）——\nasync function GET(req) {\n    try {\n        const pid = Number(req.nextUrl.searchParams.get(\"product_id\") || 0);\n        const limit = Number(req.nextUrl.searchParams.get(\"limit\") || 10);\n        const ck = (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n        const host = (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.headers)().get(\"host\") || undefined;\n        const preset = (0,_lib_odooPresets__WEBPACK_IMPORTED_MODULE_2__.resolvePreset)(host);\n        const base = ck.get(\"od_base\")?.value || preset?.url;\n        const session = ck.get(\"od_session\")?.value;\n        const companyId = Number(ck.get(\"od_company\")?.value || 0) || undefined;\n        if (!base || !session) return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n            error: \"未登录\"\n        }, {\n            status: 401\n        });\n        if (!pid) return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n            error: \"product_id required\"\n        }, {\n            status: 400\n        });\n        const cookieStr = `session_id=${session}`;\n        const context = {};\n        if (companyId) {\n            context.company_id = companyId;\n            context.allowed_company_ids = [\n                companyId\n            ];\n        }\n        // 用 stock.move 读近几条完成的移动作为历史\n        const moveIds = await rpc(base, \"/web/dataset/call_kw\", {\n            model: \"stock.move\",\n            method: \"search\",\n            args: [\n                [\n                    [\n                        \"product_id\",\n                        \"=\",\n                        pid\n                    ],\n                    [\n                        \"state\",\n                        \"=\",\n                        \"done\"\n                    ]\n                ]\n            ],\n            kwargs: {\n                limit,\n                order: \"date desc\",\n                context\n            }\n        }, cookieStr);\n        if (!Array.isArray(moveIds?.result) || !moveIds.result.length) {\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n                history: []\n            });\n        }\n        const moves = await rpc(base, \"/web/dataset/call_kw\", {\n            model: \"stock.move\",\n            method: \"read\",\n            args: [\n                moveIds.result,\n                [\n                    \"id\",\n                    \"date\",\n                    \"product_uom_qty\",\n                    \"product_uom\",\n                    \"location_id\",\n                    \"location_dest_id\",\n                    \"reference\",\n                    \"create_uid\",\n                    \"write_uid\"\n                ]\n            ],\n            kwargs: {\n                context\n            }\n        }, cookieStr);\n        const out = (moves?.result || []).map((m)=>({\n                id: m.id,\n                date: m.date,\n                qty_done: m.product_uom_qty,\n                uom: m.product_uom?.[1],\n                from: m.location_id?.[1],\n                to: m.location_dest_id?.[1],\n                ref: m.reference,\n                created_by: m.create_uid?.[1],\n                updated_by: m.write_uid?.[1]\n            }));\n        return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n            history: out\n        });\n    } catch (e) {\n        return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n            error: e?.message || \"查询历史失败\"\n        }, {\n            status: 500\n        });\n    }\n}\n// —— POST: 盘点（调整到 new_qty），自动选库位 ——\n// 会优先尝试 stock.quant.apply（新版本），失败则回退到旧版向导 stock.change.product.qty\nasync function POST(req) {\n    try {\n        const { product_id, new_qty, location_id } = await req.json();\n        const ck = (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n        const host = (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.headers)().get(\"host\") || undefined;\n        const preset = (0,_lib_odooPresets__WEBPACK_IMPORTED_MODULE_2__.resolvePreset)(host);\n        const base = ck.get(\"od_base\")?.value || preset?.url;\n        const session = ck.get(\"od_session\")?.value;\n        const companyId = Number(ck.get(\"od_company\")?.value || 0) || undefined;\n        if (!base || !session) return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n            error: \"未登录\"\n        }, {\n            status: 401\n        });\n        if (!product_id || typeof new_qty !== \"number\" || Number.isNaN(new_qty)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n                error: \"缺少 product_id 或 new_qty\"\n            }, {\n                status: 400\n            });\n        }\n        const cookieStr = `session_id=${session}`;\n        const ctx = {};\n        if (companyId) {\n            ctx.company_id = companyId;\n            ctx.allowed_company_ids = [\n                companyId\n            ];\n        }\n        // ① 确定要用的库位：优先 body.location_id；否则 cookie；否则根据“当前公司”自动找 WH/Stock\n        let locId = Number(location_id || 0) || Number(ck.get(\"od_location\")?.value || 0) || undefined;\n        if (!locId) {\n            locId = await getDefaultLocationForCompany(base, cookieStr, companyId);\n        }\n        if (!locId) return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n            error: \"缺少 location_id（已尝试自动匹配但未找到，请选择具体库位）\"\n        }, {\n            status: 400\n        });\n        // view 库位保护：必要时下钻到 internal\n        locId = await resolveEffectiveLocation(base, cookieStr, locId);\n        // ② 保存本次自动判定的库位，便于下次无需再传\n        const resp = next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n            ok: true,\n            location_id: locId,\n            method: \"pending\"\n        });\n        resp.cookies.set(\"od_location\", String(locId), {\n            path: \"/\",\n            maxAge: 60 * 60 * 24 * 30\n        });\n        // ③ Odoo 17 库存调整方法\n        // 尝试多种方法以确保兼容性\n        try {\n            // 方法1: 尝试使用 stock.inventory 模型（Odoo 17推荐）\n            try {\n                // 创建库存调整记录\n                const inventory = await rpc(base, \"/web/dataset/call_kw\", {\n                    model: \"stock.inventory\",\n                    method: \"create\",\n                    args: [\n                        [\n                            {\n                                name: `库存调整 - ${new Date().toLocaleString()}`,\n                                location_ids: [\n                                    [\n                                        6,\n                                        0,\n                                        [\n                                            locId\n                                        ]\n                                    ]\n                                ],\n                                product_ids: [\n                                    [\n                                        6,\n                                        0,\n                                        [\n                                            product_id\n                                        ]\n                                    ]\n                                ],\n                                state: \"draft\"\n                            }\n                        ]\n                    ],\n                    kwargs: {\n                        context: ctx\n                    }\n                }, cookieStr);\n                if (inventory?.result) {\n                    // 添加库存调整行\n                    const line = await rpc(base, \"/web/dataset/call_kw\", {\n                        model: \"stock.inventory.line\",\n                        method: \"create\",\n                        args: [\n                            [\n                                {\n                                    inventory_id: inventory.result,\n                                    product_id: product_id,\n                                    location_id: locId,\n                                    product_qty: new_qty,\n                                    theoretical_qty: 0 // 当前理论库存，设为0让系统自动计算\n                                }\n                            ]\n                        ],\n                        kwargs: {\n                            context: ctx\n                        }\n                    }, cookieStr);\n                    if (line?.result) {\n                        // 确认库存调整\n                        await rpc(base, \"/web/dataset/call_kw\", {\n                            model: \"stock.inventory\",\n                            method: \"action_validate\",\n                            args: [\n                                [\n                                    inventory.result\n                                ]\n                            ],\n                            kwargs: {\n                                context: ctx\n                            }\n                        }, cookieStr);\n                        return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n                            ok: true,\n                            method: \"stock.inventory\",\n                            location_id: locId\n                        });\n                    }\n                }\n            } catch (inventoryError) {\n                console.warn(\"stock.inventory 方法失败，尝试其他方法:\", inventoryError);\n            }\n            // 方法2: 尝试使用 stock.quant 直接调整（Odoo 17备用方法）\n            try {\n                // 查找或创建 quant 记录\n                const found = await rpc(base, \"/web/dataset/call_kw\", {\n                    model: \"stock.quant\",\n                    method: \"search\",\n                    args: [\n                        [\n                            [\n                                \"product_id\",\n                                \"=\",\n                                product_id\n                            ],\n                            [\n                                \"location_id\",\n                                \"=\",\n                                locId\n                            ]\n                        ]\n                    ],\n                    kwargs: {\n                        limit: 1,\n                        context: ctx\n                    }\n                }, cookieStr);\n                let quantId = Array.isArray(found?.result) && found.result.length ? found.result[0] : null;\n                if (!quantId) {\n                    // 创建新的 quant 记录\n                    const created = await rpc(base, \"/web/dataset/call_kw\", {\n                        model: \"stock.quant\",\n                        method: \"create\",\n                        args: [\n                            [\n                                {\n                                    product_id: product_id,\n                                    location_id: locId,\n                                    quantity: new_qty,\n                                    inventory_quantity: new_qty\n                                }\n                            ]\n                        ],\n                        kwargs: {\n                            context: ctx\n                        }\n                    }, cookieStr);\n                    quantId = created?.result;\n                } else {\n                    // 更新现有 quant 记录\n                    await rpc(base, \"/web/dataset/call_kw\", {\n                        model: \"stock.quant\",\n                        method: \"write\",\n                        args: [\n                            [\n                                quantId\n                            ],\n                            {\n                                quantity: new_qty,\n                                inventory_quantity: new_qty\n                            }\n                        ],\n                        kwargs: {\n                            context: ctx\n                        }\n                    }, cookieStr);\n                }\n                if (quantId) {\n                    // 应用库存调整\n                    await rpc(base, \"/web/dataset/call_kw\", {\n                        model: \"stock.quant\",\n                        method: \"action_apply_inventory\",\n                        args: [\n                            [\n                                quantId\n                            ]\n                        ],\n                        kwargs: {\n                            context: ctx\n                        }\n                    }, cookieStr);\n                    return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n                        ok: true,\n                        method: \"stock.quant\",\n                        location_id: locId\n                    });\n                }\n            } catch (quantError) {\n                console.warn(\"stock.quant 方法失败，尝试旧版方法:\", quantError);\n            }\n            // 方法3: 回退到旧版向导（如果仍然可用）\n            try {\n                const wiz = await rpc(base, \"/web/dataset/call_kw\", {\n                    model: \"stock.change.product.qty\",\n                    method: \"create\",\n                    args: [\n                        [\n                            {\n                                product_id,\n                                new_quantity: new_qty,\n                                location_id: locId\n                            }\n                        ]\n                    ],\n                    kwargs: {\n                        context: ctx\n                    }\n                }, cookieStr);\n                if (wiz?.result) {\n                    await rpc(base, \"/web/dataset/call_kw\", {\n                        model: \"stock.change.product.qty\",\n                        method: \"change_product_qty\",\n                        args: [\n                            [\n                                wiz.result\n                            ]\n                        ],\n                        kwargs: {\n                            context: ctx\n                        }\n                    }, cookieStr);\n                    return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n                        ok: true,\n                        method: \"legacy.wizard\",\n                        location_id: locId\n                    });\n                }\n            } catch (legacyError) {\n                console.warn(\"旧版向导也失败:\", legacyError);\n            }\n            throw new Error(\"所有库存调整方法都失败了\");\n        } catch (e) {\n            console.error(\"库存更新失败:\", e);\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n                error: e?.message || \"库存更新失败\"\n            }, {\n                status: 500\n            });\n        }\n    } catch (e) {\n        return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n            error: e?.message || \"库存更新失败\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SSxDQUFDLFlBQVlTO1lBQzNCO1lBRUEsTUFBTSxJQUFJeEYsTUFBTTtRQUNsQixFQUFFLE9BQU91RCxHQUFRO1lBQ2Z1QixRQUFRbEQsS0FBSyxDQUFDLFdBQVcyQjtZQUN6QixPQUFPeEYscURBQVlBLENBQUNtQixJQUFJLENBQUM7Z0JBQUUwQyxPQUFPMkIsR0FBR0MsV0FBVztZQUFTLEdBQUc7Z0JBQUUzQixRQUFRO1lBQUk7UUFDNUU7SUFDRixFQUFFLE9BQU8wQixHQUFRO1FBQ2YsT0FBT3hGLHFEQUFZQSxDQUFDbUIsSUFBSSxDQUFDO1lBQUUwQyxPQUFPMkIsR0FBR0MsV0FBVztRQUFTLEdBQUc7WUFBRTNCLFFBQVE7UUFBSTtJQUM1RTtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vb2Rvby1pbnZlbnRvcnktc2Nhbm5lci8uL2FwcC9hcGkvaW52ZW50b3J5L3JvdXRlLnRzPzlhOWQiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gYXBwL2FwaS9pbnZlbnRvcnkvcm91dGUudHNcclxuaW1wb3J0IHsgY29va2llcywgaGVhZGVycyB9IGZyb20gJ25leHQvaGVhZGVycyc7XHJcbmltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCB7IHJlc29sdmVQcmVzZXQgfSBmcm9tICdAL2xpYi9vZG9vUHJlc2V0cyc7XHJcblxyXG4vLyDpgJrnlKggUlBDIOWwgeijhVxyXG5hc3luYyBmdW5jdGlvbiBycGModXJsOiBzdHJpbmcsIHBhdGg6IHN0cmluZywgYm9keTogYW55LCBjb29raWU6IHN0cmluZykge1xyXG4gIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKGAke3VybH0ke3BhdGh9YCwge1xyXG4gICAgbWV0aG9kOiAnUE9TVCcsXHJcbiAgICBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsIGNvb2tpZSB9LFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBqc29ucnBjOiAnMi4wJywgaWQ6IERhdGUubm93KCksIG1ldGhvZDogJ2NhbGwnLCBwYXJhbXM6IGJvZHkgfSksXHJcbiAgICBjYWNoZTogJ25vLXN0b3JlJyxcclxuICB9KTtcclxuICBjb25zdCBkYXRhID0gYXdhaXQgcmVzLmpzb24oKS5jYXRjaCgoKSA9PiAoe30pKTtcclxuICByZXR1cm4gZGF0YTtcclxufVxyXG5cclxuLy8g5aaC5p6c5Lyg5YWl55qE5pivIHZpZXcg57G75Z6L5bqT5L2N77yM5ZCR5LiL5om+5LiA5LiqIGludGVybmFsIOWtkOW6k+S9jVxyXG5hc3luYyBmdW5jdGlvbiByZXNvbHZlRWZmZWN0aXZlTG9jYXRpb24oYmFzZTogc3RyaW5nLCBjb29raWVTdHI6IHN0cmluZywgbG9jSWQ6IG51bWJlcik6IFByb21pc2U8bnVtYmVyPiB7XHJcbiAgY29uc3QgcmVhZCA9IGF3YWl0IHJwYyhiYXNlLCAnL3dlYi9kYXRhc2V0L2NhbGxfa3cnLCB7XHJcbiAgICBtb2RlbDogJ3N0b2NrLmxvY2F0aW9uJyxcclxuICAgIG1ldGhvZDogJ3JlYWQnLFxyXG4gICAgYXJnczogW1tsb2NJZF0sIFsnaWQnLCAndXNhZ2UnXV0sXHJcbiAgICBrd2FyZ3M6IHt9LFxyXG4gIH0sIGNvb2tpZVN0cik7XHJcblxyXG4gIGNvbnN0IGxvYyA9IEFycmF5LmlzQXJyYXkocmVhZD8ucmVzdWx0KSAmJiByZWFkLnJlc3VsdFswXTtcclxuICBpZiAoIWxvYykgdGhyb3cgbmV3IEVycm9yKGBMb2NhdGlvbiAke2xvY0lkfSBub3QgZm91bmRgKTtcclxuICBpZiAobG9jLnVzYWdlICE9PSAndmlldycpIHJldHVybiBsb2NJZDtcclxuXHJcbiAgY29uc3QgY2hpbGQgPSBhd2FpdCBycGMoYmFzZSwgJy93ZWIvZGF0YXNldC9jYWxsX2t3Jywge1xyXG4gICAgbW9kZWw6ICdzdG9jay5sb2NhdGlvbicsXHJcbiAgICBtZXRob2Q6ICdzZWFyY2gnLFxyXG4gICAgYXJnczogW1tbJ2xvY2F0aW9uX2lkJywgJz0nLCBsb2NJZF0sIFsndXNhZ2UnLCAnPScsICdpbnRlcm5hbCddXV0sXHJcbiAgICBrd2FyZ3M6IHsgbGltaXQ6IDEgfSxcclxuICB9LCBjb29raWVTdHIpO1xyXG5cclxuICBpZiAoQXJyYXkuaXNBcnJheShjaGlsZD8ucmVzdWx0KSAmJiBjaGlsZC5yZXN1bHQubGVuZ3RoKSByZXR1cm4gY2hpbGQucmVzdWx0WzBdO1xyXG4gIHRocm93IG5ldyBFcnJvcihgTG9jYXRpb24gJHtsb2NJZH0gaXMgJ3ZpZXcnIGFuZCBoYXMgbm8gaW50ZXJuYWwgY2hpbGQuIFBsZWFzZSBjaG9vc2UgYW4gSW50ZXJuYWwgbG9jYXRpb24gKGUuZy4gV0gvU3RvY2spLmApO1xyXG59XHJcblxyXG4vLyDinIUg5L6d5o2u4oCc5b2T5YmN5YWs5Y+44oCd6Ieq5Yqo5om+6buY6K6k5bqT5L2N77yI6K+l5YWs5Y+455qEIFdIL1N0b2Nr77yJXHJcbmFzeW5jIGZ1bmN0aW9uIGdldERlZmF1bHRMb2NhdGlvbkZvckNvbXBhbnkoYmFzZTogc3RyaW5nLCBjb29raWVTdHI6IHN0cmluZywgY29tcGFueUlkPzogbnVtYmVyKTogUHJvbWlzZTxudW1iZXIgfCB1bmRlZmluZWQ+IHtcclxuICAvLyDlsJ3or5XvvJrmi7/or6Xlhazlj7jnmoTku5PlupMgLT4gbG90X3N0b2NrX2lkXHJcbiAgaWYgKGNvbXBhbnlJZCkge1xyXG4gICAgY29uc3Qgd2hJZHMgPSBhd2FpdCBycGMoYmFzZSwgJy93ZWIvZGF0YXNldC9jYWxsX2t3Jywge1xyXG4gICAgICBtb2RlbDogJ3N0b2NrLndhcmVob3VzZScsXHJcbiAgICAgIG1ldGhvZDogJ3NlYXJjaCcsXHJcbiAgICAgIGFyZ3M6IFtbWydjb21wYW55X2lkJywgJz0nLCBjb21wYW55SWRdXV0sXHJcbiAgICAgIGt3YXJnczogeyBsaW1pdDogMSB9LFxyXG4gICAgfSwgY29va2llU3RyKTtcclxuICAgIGNvbnN0IHdpZCA9IHdoSWRzPy5yZXN1bHQ/LlswXTtcclxuICAgIGlmICh3aWQpIHtcclxuICAgICAgY29uc3Qgd2ggPSBhd2FpdCBycGMoYmFzZSwgJy93ZWIvZGF0YXNldC9jYWxsX2t3Jywge1xyXG4gICAgICAgIG1vZGVsOiAnc3RvY2sud2FyZWhvdXNlJyxcclxuICAgICAgICBtZXRob2Q6ICdyZWFkJyxcclxuICAgICAgICBhcmdzOiBbW3dpZF0sIFsnbG90X3N0b2NrX2lkJ11dLFxyXG4gICAgICAgIGt3YXJnczoge30sXHJcbiAgICAgIH0sIGNvb2tpZVN0cik7XHJcbiAgICAgIGNvbnN0IGxvdCA9IHdoPy5yZXN1bHQ/LlswXT8ubG90X3N0b2NrX2lkPy5bMF07XHJcbiAgICAgIGlmIChsb3QpIHJldHVybiBsb3Q7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvLyDlhZzlupXvvJrpmo/lhazlj7jojIPlm7Tmib7ku7vmhI/kuIDkuKogaW50ZXJuYWwg5bqT5L2NXHJcbiAgY29uc3QgZG9tYWluOiBhbnlbXSA9IFtbJ3VzYWdlJywgJz0nLCAnaW50ZXJuYWwnXV07XHJcbiAgaWYgKGNvbXBhbnlJZCkgZG9tYWluLnB1c2goWydjb21wYW55X2lkJywgJz0nLCBjb21wYW55SWRdKTtcclxuICBjb25zdCBsb2NJZHMgPSBhd2FpdCBycGMoYmFzZSwgJy93ZWIvZGF0YXNldC9jYWxsX2t3Jywge1xyXG4gICAgbW9kZWw6ICdzdG9jay5sb2NhdGlvbicsXHJcbiAgICBtZXRob2Q6ICdzZWFyY2gnLFxyXG4gICAgYXJnczogW2RvbWFpbl0sXHJcbiAgICBrd2FyZ3M6IHsgbGltaXQ6IDEgfSxcclxuICB9LCBjb29raWVTdHIpO1xyXG4gIHJldHVybiBsb2NJZHM/LnJlc3VsdD8uWzBdO1xyXG59XHJcblxyXG4vLyDigJTigJQgR0VUOiDmnIDov5HlupPlrZjlj5jliqjvvIjnroDniYjljoblj7LvvInigJTigJRcclxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXE6IE5leHRSZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHBpZCA9IE51bWJlcihyZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdwcm9kdWN0X2lkJykgfHwgMCk7XHJcbiAgICBjb25zdCBsaW1pdCA9IE51bWJlcihyZXEubmV4dFVybC5zZWFyY2hQYXJhbXMuZ2V0KCdsaW1pdCcpIHx8IDEwKTtcclxuXHJcbiAgICBjb25zdCBjayA9IGNvb2tpZXMoKTtcclxuICAgIGNvbnN0IGhvc3QgPSBoZWFkZXJzKCkuZ2V0KCdob3N0JykgfHwgdW5kZWZpbmVkO1xyXG4gICAgY29uc3QgcHJlc2V0ID0gcmVzb2x2ZVByZXNldChob3N0KTtcclxuXHJcbiAgICBjb25zdCBiYXNlID0gY2suZ2V0KCdvZF9iYXNlJyk/LnZhbHVlIHx8IHByZXNldD8udXJsO1xyXG4gICAgY29uc3Qgc2Vzc2lvbiA9IGNrLmdldCgnb2Rfc2Vzc2lvbicpPy52YWx1ZTtcclxuICAgIGNvbnN0IGNvbXBhbnlJZCA9IE51bWJlcihjay5nZXQoJ29kX2NvbXBhbnknKT8udmFsdWUgfHwgMCkgfHwgdW5kZWZpbmVkO1xyXG4gICAgaWYgKCFiYXNlIHx8ICFzZXNzaW9uKSByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ+acqueZu+W9lScgfSwgeyBzdGF0dXM6IDQwMSB9KTtcclxuICAgIGlmICghcGlkKSByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ3Byb2R1Y3RfaWQgcmVxdWlyZWQnIH0sIHsgc3RhdHVzOiA0MDAgfSk7XHJcblxyXG4gICAgY29uc3QgY29va2llU3RyID0gYHNlc3Npb25faWQ9JHtzZXNzaW9ufWA7XHJcbiAgICBjb25zdCBjb250ZXh0OiBhbnkgPSB7fTtcclxuICAgIGlmIChjb21wYW55SWQpIHsgY29udGV4dC5jb21wYW55X2lkID0gY29tcGFueUlkOyBjb250ZXh0LmFsbG93ZWRfY29tcGFueV9pZHMgPSBbY29tcGFueUlkXTsgfVxyXG5cclxuICAgIC8vIOeUqCBzdG9jay5tb3ZlIOivu+i/keWHoOadoeWujOaIkOeahOenu+WKqOS9nOS4uuWOhuWPslxyXG4gICAgY29uc3QgbW92ZUlkcyA9IGF3YWl0IHJwYyhiYXNlLCAnL3dlYi9kYXRhc2V0L2NhbGxfa3cnLCB7XHJcbiAgICAgIG1vZGVsOiAnc3RvY2subW92ZScsXHJcbiAgICAgIG1ldGhvZDogJ3NlYXJjaCcsXHJcbiAgICAgIGFyZ3M6IFtbXHJcbiAgICAgICAgWydwcm9kdWN0X2lkJywgJz0nLCBwaWRdLFxyXG4gICAgICAgIFsnc3RhdGUnLCAnPScsICdkb25lJ10sXHJcbiAgICAgIF1dLFxyXG4gICAgICBrd2FyZ3M6IHsgbGltaXQsIG9yZGVyOiAnZGF0ZSBkZXNjJywgY29udGV4dCB9LFxyXG4gICAgfSwgY29va2llU3RyKTtcclxuXHJcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkobW92ZUlkcz8ucmVzdWx0KSB8fCAhbW92ZUlkcy5yZXN1bHQubGVuZ3RoKSB7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGhpc3Rvcnk6IFtdIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG1vdmVzID0gYXdhaXQgcnBjKGJhc2UsICcvd2ViL2RhdGFzZXQvY2FsbF9rdycsIHtcclxuICAgICAgbW9kZWw6ICdzdG9jay5tb3ZlJyxcclxuICAgICAgbWV0aG9kOiAncmVhZCcsXHJcbiAgICAgIGFyZ3M6IFttb3ZlSWRzLnJlc3VsdCwgWydpZCcsICdkYXRlJywgJ3Byb2R1Y3RfdW9tX3F0eScsICdwcm9kdWN0X3VvbScsICdsb2NhdGlvbl9pZCcsICdsb2NhdGlvbl9kZXN0X2lkJywgJ3JlZmVyZW5jZScsICdjcmVhdGVfdWlkJywgJ3dyaXRlX3VpZCddXSxcclxuICAgICAga3dhcmdzOiB7IGNvbnRleHQgfSxcclxuICAgIH0sIGNvb2tpZVN0cik7XHJcblxyXG4gICAgY29uc3Qgb3V0ID0gKG1vdmVzPy5yZXN1bHQgfHwgW10pLm1hcCgobTogYW55KSA9PiAoe1xyXG4gICAgICBpZDogbS5pZCxcclxuICAgICAgZGF0ZTogbS5kYXRlLFxyXG4gICAgICBxdHlfZG9uZTogbS5wcm9kdWN0X3VvbV9xdHksXHJcbiAgICAgIHVvbTogbS5wcm9kdWN0X3VvbT8uWzFdLFxyXG4gICAgICBmcm9tOiBtLmxvY2F0aW9uX2lkPy5bMV0sXHJcbiAgICAgIHRvOiBtLmxvY2F0aW9uX2Rlc3RfaWQ/LlsxXSxcclxuICAgICAgcmVmOiBtLnJlZmVyZW5jZSxcclxuICAgICAgY3JlYXRlZF9ieTogbS5jcmVhdGVfdWlkPy5bMV0sXHJcbiAgICAgIHVwZGF0ZWRfYnk6IG0ud3JpdGVfdWlkPy5bMV0sXHJcbiAgICB9KSk7XHJcblxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgaGlzdG9yeTogb3V0IH0pO1xyXG4gIH0gY2F0Y2ggKGU6IGFueSkge1xyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IGU/Lm1lc3NhZ2UgfHwgJ+afpeivouWOhuWPsuWksei0pScgfSwgeyBzdGF0dXM6IDUwMCB9KTtcclxuICB9XHJcbn1cclxuXHJcbi8vIOKAlOKAlCBQT1NUOiDnm5jngrnvvIjosIPmlbTliLAgbmV3X3F0ee+8ie+8jOiHquWKqOmAieW6k+S9jSDigJTigJRcclxuLy8g5Lya5LyY5YWI5bCd6K+VIHN0b2NrLnF1YW50LmFwcGx577yI5paw54mI5pys77yJ77yM5aSx6LSl5YiZ5Zue6YCA5Yiw5pen54mI5ZCR5a+8IHN0b2NrLmNoYW5nZS5wcm9kdWN0LnF0eVxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXE6IE5leHRSZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IHsgcHJvZHVjdF9pZCwgbmV3X3F0eSwgbG9jYXRpb25faWQgfSA9IGF3YWl0IHJlcS5qc29uKCk7XHJcblxyXG4gICAgY29uc3QgY2sgPSBjb29raWVzKCk7XHJcbiAgICBjb25zdCBob3N0ID0gaGVhZGVycygpLmdldCgnaG9zdCcpIHx8IHVuZGVmaW5lZDtcclxuICAgIGNvbnN0IHByZXNldCA9IHJlc29sdmVQcmVzZXQoaG9zdCk7XHJcblxyXG4gICAgY29uc3QgYmFzZSA9IGNrLmdldCgnb2RfYmFzZScpPy52YWx1ZSB8fCBwcmVzZXQ/LnVybDtcclxuICAgIGNvbnN0IHNlc3Npb24gPSBjay5nZXQoJ29kX3Nlc3Npb24nKT8udmFsdWU7XHJcbiAgICBjb25zdCBjb21wYW55SWQgPSBOdW1iZXIoY2suZ2V0KCdvZF9jb21wYW55Jyk/LnZhbHVlIHx8IDApIHx8IHVuZGVmaW5lZDtcclxuXHJcbiAgICBpZiAoIWJhc2UgfHwgIXNlc3Npb24pIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAn5pyq55m75b2VJyB9LCB7IHN0YXR1czogNDAxIH0pO1xyXG4gICAgaWYgKCFwcm9kdWN0X2lkIHx8IHR5cGVvZiBuZXdfcXR5ICE9PSAnbnVtYmVyJyB8fCBOdW1iZXIuaXNOYU4obmV3X3F0eSkpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICfnvLrlsJEgcHJvZHVjdF9pZCDmiJYgbmV3X3F0eScgfSwgeyBzdGF0dXM6IDQwMCB9KTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjb29raWVTdHIgPSBgc2Vzc2lvbl9pZD0ke3Nlc3Npb259YDtcclxuICAgIGNvbnN0IGN0eDogYW55ID0ge307XHJcbiAgICBpZiAoY29tcGFueUlkKSB7IGN0eC5jb21wYW55X2lkID0gY29tcGFueUlkOyBjdHguYWxsb3dlZF9jb21wYW55X2lkcyA9IFtjb21wYW55SWRdOyB9XHJcblxyXG4gICAgLy8g4pGgIOehruWumuimgeeUqOeahOW6k+S9je+8muS8mOWFiCBib2R5LmxvY2F0aW9uX2lk77yb5ZCm5YiZIGNvb2tpZe+8m+WQpuWImeagueaNruKAnOW9k+WJjeWFrOWPuOKAneiHquWKqOaJviBXSC9TdG9ja1xyXG4gICAgbGV0IGxvY0lkOiBudW1iZXIgfCB1bmRlZmluZWQgPSBOdW1iZXIobG9jYXRpb25faWQgfHwgMCkgfHwgTnVtYmVyKGNrLmdldCgnb2RfbG9jYXRpb24nKT8udmFsdWUgfHwgMCkgfHwgdW5kZWZpbmVkO1xyXG4gICAgaWYgKCFsb2NJZCkge1xyXG4gICAgICBsb2NJZCA9IGF3YWl0IGdldERlZmF1bHRMb2NhdGlvbkZvckNvbXBhbnkoYmFzZSwgY29va2llU3RyLCBjb21wYW55SWQpO1xyXG4gICAgfVxyXG4gICAgaWYgKCFsb2NJZCkgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICfnvLrlsJEgbG9jYXRpb25faWTvvIjlt7LlsJ3or5Xoh6rliqjljLnphY3kvYbmnKrmib7liLDvvIzor7fpgInmi6nlhbfkvZPlupPkvY3vvIknIH0sIHsgc3RhdHVzOiA0MDAgfSk7XHJcblxyXG4gICAgLy8gdmlldyDlupPkvY3kv53miqTvvJrlv4XopoHml7bkuIvpkrvliLAgaW50ZXJuYWxcclxuICAgIGxvY0lkID0gYXdhaXQgcmVzb2x2ZUVmZmVjdGl2ZUxvY2F0aW9uKGJhc2UsIGNvb2tpZVN0ciwgbG9jSWQpO1xyXG5cclxuICAgIC8vIOKRoSDkv53lrZjmnKzmrKHoh6rliqjliKTlrprnmoTlupPkvY3vvIzkvr/kuo7kuIvmrKHml6DpnIDlho3kvKBcclxuICAgIGNvbnN0IHJlc3AgPSBOZXh0UmVzcG9uc2UuanNvbih7IG9rOiB0cnVlLCBsb2NhdGlvbl9pZDogbG9jSWQsIG1ldGhvZDogJ3BlbmRpbmcnIH0pO1xyXG4gICAgcmVzcC5jb29raWVzLnNldCgnb2RfbG9jYXRpb24nLCBTdHJpbmcobG9jSWQpLCB7IHBhdGg6ICcvJywgbWF4QWdlOiA2MCAqIDYwICogMjQgKiAzMCB9KTtcclxuXHJcbiAgICAvLyDikaIgT2RvbyAxNyDlupPlrZjosIPmlbTmlrnms5VcclxuICAgIC8vIOWwneivleWkmuenjeaWueazleS7peehruS/neWFvOWuueaAp1xyXG4gICAgdHJ5IHtcclxuICAgICAgLy8g5pa55rOVMTog5bCd6K+V5L2/55SoIHN0b2NrLmludmVudG9yeSDmqKHlnovvvIhPZG9vIDE35o6o6I2Q77yJXHJcbiAgICAgIHRyeSB7XHJcbiAgICAgICAgLy8g5Yib5bu65bqT5a2Y6LCD5pW06K6w5b2VXHJcbiAgICAgICAgY29uc3QgaW52ZW50b3J5ID0gYXdhaXQgcnBjKGJhc2UsICcvd2ViL2RhdGFzZXQvY2FsbF9rdycsIHtcclxuICAgICAgICAgIG1vZGVsOiAnc3RvY2suaW52ZW50b3J5JyxcclxuICAgICAgICAgIG1ldGhvZDogJ2NyZWF0ZScsXHJcbiAgICAgICAgICBhcmdzOiBbW3tcclxuICAgICAgICAgICAgbmFtZTogYOW6k+WtmOiwg+aVtCAtICR7bmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygpfWAsXHJcbiAgICAgICAgICAgIGxvY2F0aW9uX2lkczogW1s2LCAwLCBbbG9jSWRdXV0sXHJcbiAgICAgICAgICAgIHByb2R1Y3RfaWRzOiBbWzYsIDAsIFtwcm9kdWN0X2lkXV1dLFxyXG4gICAgICAgICAgICBzdGF0ZTogJ2RyYWZ0J1xyXG4gICAgICAgICAgfV1dLFxyXG4gICAgICAgICAga3dhcmdzOiB7IGNvbnRleHQ6IGN0eCB9LFxyXG4gICAgICAgIH0sIGNvb2tpZVN0cik7XHJcblxyXG4gICAgICAgIGlmIChpbnZlbnRvcnk/LnJlc3VsdCkge1xyXG4gICAgICAgICAgLy8g5re75Yqg5bqT5a2Y6LCD5pW06KGMXHJcbiAgICAgICAgICBjb25zdCBsaW5lID0gYXdhaXQgcnBjKGJhc2UsICcvd2ViL2RhdGFzZXQvY2FsbF9rdycsIHtcclxuICAgICAgICAgICAgbW9kZWw6ICdzdG9jay5pbnZlbnRvcnkubGluZScsXHJcbiAgICAgICAgICAgIG1ldGhvZDogJ2NyZWF0ZScsXHJcbiAgICAgICAgICAgIGFyZ3M6IFtbe1xyXG4gICAgICAgICAgICAgIGludmVudG9yeV9pZDogaW52ZW50b3J5LnJlc3VsdCxcclxuICAgICAgICAgICAgICBwcm9kdWN0X2lkOiBwcm9kdWN0X2lkLFxyXG4gICAgICAgICAgICAgIGxvY2F0aW9uX2lkOiBsb2NJZCxcclxuICAgICAgICAgICAgICBwcm9kdWN0X3F0eTogbmV3X3F0eSxcclxuICAgICAgICAgICAgICB0aGVvcmV0aWNhbF9xdHk6IDAgLy8g5b2T5YmN55CG6K665bqT5a2Y77yM6K6+5Li6MOiuqeezu+e7n+iHquWKqOiuoeeul1xyXG4gICAgICAgICAgICB9XV0sXHJcbiAgICAgICAgICAgIGt3YXJnczogeyBjb250ZXh0OiBjdHggfSxcclxuICAgICAgICAgIH0sIGNvb2tpZVN0cik7XHJcblxyXG4gICAgICAgICAgaWYgKGxpbmU/LnJlc3VsdCkge1xyXG4gICAgICAgICAgICAvLyDnoa7orqTlupPlrZjosIPmlbRcclxuICAgICAgICAgICAgYXdhaXQgcnBjKGJhc2UsICcvd2ViL2RhdGFzZXQvY2FsbF9rdycsIHtcclxuICAgICAgICAgICAgICBtb2RlbDogJ3N0b2NrLmludmVudG9yeScsXHJcbiAgICAgICAgICAgICAgbWV0aG9kOiAnYWN0aW9uX3ZhbGlkYXRlJyxcclxuICAgICAgICAgICAgICBhcmdzOiBbW2ludmVudG9yeS5yZXN1bHRdXSxcclxuICAgICAgICAgICAgICBrd2FyZ3M6IHsgY29udGV4dDogY3R4IH0sXHJcbiAgICAgICAgICAgIH0sIGNvb2tpZVN0cik7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBvazogdHJ1ZSwgbWV0aG9kOiAnc3RvY2suaW52ZW50b3J5JywgbG9jYXRpb25faWQ6IGxvY0lkIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSBjYXRjaCAoaW52ZW50b3J5RXJyb3IpIHtcclxuICAgICAgICBjb25zb2xlLndhcm4oJ3N0b2NrLmludmVudG9yeSDmlrnms5XlpLHotKXvvIzlsJ3or5Xlhbbku5bmlrnms5U6JywgaW52ZW50b3J5RXJyb3IpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDmlrnms5UyOiDlsJ3or5Xkvb/nlKggc3RvY2sucXVhbnQg55u05o6l6LCD5pW077yIT2RvbyAxN+Wkh+eUqOaWueazle+8iVxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIC8vIOafpeaJvuaIluWIm+W7uiBxdWFudCDorrDlvZVcclxuICAgICAgICBjb25zdCBmb3VuZCA9IGF3YWl0IHJwYyhiYXNlLCAnL3dlYi9kYXRhc2V0L2NhbGxfa3cnLCB7XHJcbiAgICAgICAgICBtb2RlbDogJ3N0b2NrLnF1YW50JyxcclxuICAgICAgICAgIG1ldGhvZDogJ3NlYXJjaCcsXHJcbiAgICAgICAgICBhcmdzOiBbW1sncHJvZHVjdF9pZCcsICc9JywgcHJvZHVjdF9pZF0sIFsnbG9jYXRpb25faWQnLCAnPScsIGxvY0lkXV1dLFxyXG4gICAgICAgICAga3dhcmdzOiB7IGxpbWl0OiAxLCBjb250ZXh0OiBjdHggfSxcclxuICAgICAgICB9LCBjb29raWVTdHIpO1xyXG5cclxuICAgICAgICBsZXQgcXVhbnRJZCA9IEFycmF5LmlzQXJyYXkoZm91bmQ/LnJlc3VsdCkgJiYgZm91bmQucmVzdWx0Lmxlbmd0aCA/IGZvdW5kLnJlc3VsdFswXSA6IG51bGw7XHJcblxyXG4gICAgICAgIGlmICghcXVhbnRJZCkge1xyXG4gICAgICAgICAgLy8g5Yib5bu65paw55qEIHF1YW50IOiusOW9lVxyXG4gICAgICAgICAgY29uc3QgY3JlYXRlZCA9IGF3YWl0IHJwYyhiYXNlLCAnL3dlYi9kYXRhc2V0L2NhbGxfa3cnLCB7XHJcbiAgICAgICAgICAgIG1vZGVsOiAnc3RvY2sucXVhbnQnLFxyXG4gICAgICAgICAgICBtZXRob2Q6ICdjcmVhdGUnLFxyXG4gICAgICAgICAgICBhcmdzOiBbW3tcclxuICAgICAgICAgICAgICBwcm9kdWN0X2lkOiBwcm9kdWN0X2lkLFxyXG4gICAgICAgICAgICAgIGxvY2F0aW9uX2lkOiBsb2NJZCxcclxuICAgICAgICAgICAgICBxdWFudGl0eTogbmV3X3F0eSxcclxuICAgICAgICAgICAgICBpbnZlbnRvcnlfcXVhbnRpdHk6IG5ld19xdHlcclxuICAgICAgICAgICAgfV1dLFxyXG4gICAgICAgICAgICBrd2FyZ3M6IHsgY29udGV4dDogY3R4IH0sXHJcbiAgICAgICAgICB9LCBjb29raWVTdHIpO1xyXG4gICAgICAgICAgcXVhbnRJZCA9IGNyZWF0ZWQ/LnJlc3VsdDtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgLy8g5pu05paw546w5pyJIHF1YW50IOiusOW9lVxyXG4gICAgICAgICAgYXdhaXQgcnBjKGJhc2UsICcvd2ViL2RhdGFzZXQvY2FsbF9rdycsIHtcclxuICAgICAgICAgICAgbW9kZWw6ICdzdG9jay5xdWFudCcsXHJcbiAgICAgICAgICAgIG1ldGhvZDogJ3dyaXRlJyxcclxuICAgICAgICAgICAgYXJnczogW1txdWFudElkXSwge1xyXG4gICAgICAgICAgICAgIHF1YW50aXR5OiBuZXdfcXR5LFxyXG4gICAgICAgICAgICAgIGludmVudG9yeV9xdWFudGl0eTogbmV3X3F0eVxyXG4gICAgICAgICAgICB9XSxcclxuICAgICAgICAgICAga3dhcmdzOiB7IGNvbnRleHQ6IGN0eCB9LFxyXG4gICAgICAgICAgfSwgY29va2llU3RyKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChxdWFudElkKSB7XHJcbiAgICAgICAgICAvLyDlupTnlKjlupPlrZjosIPmlbRcclxuICAgICAgICAgIGF3YWl0IHJwYyhiYXNlLCAnL3dlYi9kYXRhc2V0L2NhbGxfa3cnLCB7XHJcbiAgICAgICAgICAgIG1vZGVsOiAnc3RvY2sucXVhbnQnLFxyXG4gICAgICAgICAgICBtZXRob2Q6ICdhY3Rpb25fYXBwbHlfaW52ZW50b3J5JyxcclxuICAgICAgICAgICAgYXJnczogW1txdWFudElkXV0sXHJcbiAgICAgICAgICAgIGt3YXJnczogeyBjb250ZXh0OiBjdHggfSxcclxuICAgICAgICAgIH0sIGNvb2tpZVN0cik7XHJcblxyXG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgb2s6IHRydWUsIG1ldGhvZDogJ3N0b2NrLnF1YW50JywgbG9jYXRpb25faWQ6IGxvY0lkIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgfSBjYXRjaCAocXVhbnRFcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUud2Fybignc3RvY2sucXVhbnQg5pa55rOV5aSx6LSl77yM5bCd6K+V5pen54mI5pa55rOVOicsIHF1YW50RXJyb3IpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICAvLyDmlrnms5UzOiDlm57pgIDliLDml6fniYjlkJHlr7zvvIjlpoLmnpzku43nhLblj6/nlKjvvIlcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB3aXogPSBhd2FpdCBycGMoYmFzZSwgJy93ZWIvZGF0YXNldC9jYWxsX2t3Jywge1xyXG4gICAgICAgICAgbW9kZWw6ICdzdG9jay5jaGFuZ2UucHJvZHVjdC5xdHknLFxyXG4gICAgICAgICAgbWV0aG9kOiAnY3JlYXRlJyxcclxuICAgICAgICAgIGFyZ3M6IFtbeyBcclxuICAgICAgICAgICAgcHJvZHVjdF9pZCwgXHJcbiAgICAgICAgICAgIG5ld19xdWFudGl0eTogbmV3X3F0eSwgXHJcbiAgICAgICAgICAgIGxvY2F0aW9uX2lkOiBsb2NJZCBcclxuICAgICAgICAgIH1dXSxcclxuICAgICAgICAgIGt3YXJnczogeyBjb250ZXh0OiBjdHggfSxcclxuICAgICAgICB9LCBjb29raWVTdHIpO1xyXG5cclxuICAgICAgICBpZiAod2l6Py5yZXN1bHQpIHtcclxuICAgICAgICAgIGF3YWl0IHJwYyhiYXNlLCAnL3dlYi9kYXRhc2V0L2NhbGxfa3cnLCB7XHJcbiAgICAgICAgICAgIG1vZGVsOiAnc3RvY2suY2hhbmdlLnByb2R1Y3QucXR5JyxcclxuICAgICAgICAgICAgbWV0aG9kOiAnY2hhbmdlX3Byb2R1Y3RfcXR5JyxcclxuICAgICAgICAgICAgYXJnczogW1t3aXoucmVzdWx0XV0sXHJcbiAgICAgICAgICAgIGt3YXJnczogeyBjb250ZXh0OiBjdHggfSxcclxuICAgICAgICAgIH0sIGNvb2tpZVN0cik7XHJcblxyXG4gICAgICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgb2s6IHRydWUsIG1ldGhvZDogJ2xlZ2FjeS53aXphcmQnLCBsb2NhdGlvbl9pZDogbG9jSWQgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGNhdGNoIChsZWdhY3lFcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUud2Fybign5pen54mI5ZCR5a+85Lmf5aSx6LSlOicsIGxlZ2FjeUVycm9yKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgdGhyb3cgbmV3IEVycm9yKCfmiYDmnInlupPlrZjosIPmlbTmlrnms5Xpg73lpLHotKXkuoYnKTtcclxuICAgIH0gY2F0Y2ggKGU6IGFueSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCflupPlrZjmm7TmlrDlpLHotKU6JywgZSk7XHJcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBlPy5tZXNzYWdlIHx8ICflupPlrZjmm7TmlrDlpLHotKUnIH0sIHsgc3RhdHVzOiA1MDAgfSk7XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogZT8ubWVzc2FnZSB8fCAn5bqT5a2Y5pu05paw5aSx6LSlJyB9LCB7IHN0YXR1czogNTAwIH0pO1xyXG4gIH1cclxufSJdLCJuYW1lcyI6WyJjb29raWVzIiwiaGVhZGVycyIsIk5leHRSZXNwb25zZSIsInJlc29sdmVQcmVzZXQiLCJycGMiLCJ1cmwiLCJwYXRoIiwiYm9keSIsImNvb2tpZSIsInJlcyIsImZldGNoIiwibWV0aG9kIiwiSlNPTiIsInN0cmluZ2lmeSIsImpzb25ycGMiLCJpZCIsIkRhdGUiLCJub3ciLCJwYXJhbXMiLCJjYWNoZSIsImRhdGEiLCJqc29uIiwiY2F0Y2giLCJyZXNvbHZlRWZmZWN0aXZlTG9jYXRpb24iLCJiYXNlIiwiY29va2llU3RyIiwibG9jSWQiLCJyZWFkIiwibW9kZWwiLCJhcmdzIiwia3dhcmdzIiwibG9jIiwiQXJyYXkiLCJpc0FycmF5IiwicmVzdWx0IiwiRXJyb3IiLCJ1c2FnZSIsImNoaWxkIiwibGltaXQiLCJsZW5ndGgiLCJnZXREZWZhdWx0TG9jYXRpb25Gb3JDb21wYW55IiwiY29tcGFueUlkIiwid2hJZHMiLCJ3aWQiLCJ3aCIsImxvdCIsImxvdF9zdG9ja19pZCIsImRvbWFpbiIsInB1c2giLCJsb2NJZHMiLCJHRVQiLCJyZXEiLCJwaWQiLCJOdW1iZXIiLCJuZXh0VXJsIiwic2VhcmNoUGFyYW1zIiwiZ2V0IiwiY2siLCJob3N0IiwidW5kZWZpbmVkIiwicHJlc2V0IiwidmFsdWUiLCJzZXNzaW9uIiwiZXJyb3IiLCJzdGF0dXMiLCJjb250ZXh0IiwiY29tcGFueV9pZCIsImFsbG93ZWRfY29tcGFueV9pZHMiLCJtb3ZlSWRzIiwib3JkZXIiLCJoaXN0b3J5IiwibW92ZXMiLCJvdXQiLCJtYXAiLCJtIiwiZGF0ZSIsInF0eV9kb25lIiwicHJvZHVjdF91b21fcXR5IiwidW9tIiwicHJvZHVjdF91b20iLCJmcm9tIiwibG9jYXRpb25faWQiLCJ0byIsImxvY2F0aW9uX2Rlc3RfaWQiLCJyZWYiLCJyZWZlcmVuY2UiLCJjcmVhdGVkX2J5IiwiY3JlYXRlX3VpZCIsInVwZGF0ZWRfYnkiLCJ3cml0ZV91aWQiLCJlIiwibWVzc2FnZSIsIlBPU1QiLCJwcm9kdWN0X2lkIiwibmV3X3F0eSIsImlzTmFOIiwiY3R4IiwicmVzcCIsIm9rIiwic2V0IiwiU3RyaW5nIiwibWF4QWdlIiwiaW52ZW50b3J5IiwibmFtZSIsInRvTG9jYWxlU3RyaW5nIiwibG9jYXRpb25faWRzIiwicHJvZHVjdF9pZHMiLCJzdGF0ZSIsImxpbmUiLCJpbnZlbnRvcnlfaWQiLCJwcm9kdWN0X3F0eSIsInRoZW9yZXRpY2FsX3F0eSIsImludmVudG9yeUVycm9yIiwiY29uc29sZSIsIndhcm4iLCJmb3VuZCIsInF1YW50SWQiLCJjcmVhdGVkIiwicXVhbnRpdHkiLCJpbnZlbnRvcnlfcXVhbnRpdHkiLCJxdWFudEVycm9yIiwid2l6IiwibmV3X3F1YW50aXR5IiwibGVnYWN5RXJyb3IiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/inventory/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/odooPresets.ts":
/*!****************************!*\
  !*** ./lib/odooPresets.ts ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   ENV_FALLBACK: () => (/* binding */ ENV_FALLBACK),\n/* harmony export */   HOST_PRESETS: () => (/* binding */ HOST_PRESETS),\n/* harmony export */   resolvePreset: () => (/* binding */ resolvePreset)\n/* harmony export */ });\n// /lib/odooPresets.ts\nconst HOST_PRESETS = {\n    \"moboplus.co.nz\": {\n        url: \"https://moboplus.co.nz\",\n        db: \"odoo\",\n        defaultLocationId: 1\n    },\n    \"repair.raytech.co.nz\": {\n        url: \"https://repair.raytech.co.nz\",\n        db: \"db-raytech-repair\",\n        defaultLocationId: 1\n    }\n};\n// 环境变量兜底：在服务器上设置 ODOO_URL / ODOO_DB（以及可选 ODOO_LOCATION_ID）\nconst ENV_FALLBACK = process.env.ODOO_URL && process.env.ODOO_DB ? {\n    url: process.env.ODOO_URL,\n    db: process.env.ODOO_DB,\n    defaultLocationId: Number(process.env.ODOO_LOCATION_ID || 0) || undefined\n} : undefined;\nfunction resolvePreset(hostRaw) {\n    const h = (hostRaw || \"\").toLowerCase().replace(/^www\\./, \"\").split(\":\")[0]; // 去端口\n    // 容忍子域/二级域\n    if (h.endsWith(\"moboplus.co.nz\")) return HOST_PRESETS[\"moboplus.co.nz\"];\n    if (h.endsWith(\"repair.raytech.co.nz\") || h === \"raytech.co.nz\") return HOST_PRESETS[\"repair.raytech.co.nz\"];\n    // 回退到环境变量\n    return ENV_FALLBACK;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvb2Rvb1ByZXNldHMudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsc0JBQXNCO0FBR2YsTUFBTUEsZUFBMkM7SUFDdEQsa0JBQWtCO1FBQ2hCQyxLQUFLO1FBQ0xDLElBQUk7UUFDSkMsbUJBQW1CO0lBQ3JCO0lBQ0Esd0JBQXdCO1FBQ3RCRixLQUFLO1FBQ0xDLElBQUk7UUFDSkMsbUJBQW1CO0lBQ3JCO0FBQ0YsRUFBRTtBQUVGLDJEQUEyRDtBQUNwRCxNQUFNQyxlQUNYQyxRQUFRQyxHQUFHLENBQUNDLFFBQVEsSUFBSUYsUUFBUUMsR0FBRyxDQUFDRSxPQUFPLEdBQ3ZDO0lBQ0VQLEtBQUtJLFFBQVFDLEdBQUcsQ0FBQ0MsUUFBUTtJQUN6QkwsSUFBSUcsUUFBUUMsR0FBRyxDQUFDRSxPQUFPO0lBQ3ZCTCxtQkFBbUJNLE9BQU9KLFFBQVFDLEdBQUcsQ0FBQ0ksZ0JBQWdCLElBQUksTUFBTUM7QUFDbEUsSUFDQUEsVUFBVTtBQUVULFNBQVNDLGNBQWNDLE9BQWdCO0lBQzVDLE1BQU1DLElBQUksQ0FBQ0QsV0FBVyxFQUFDLEVBQ3BCRSxXQUFXLEdBQ1hDLE9BQU8sQ0FBQyxVQUFVLElBQ2xCQyxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxNQUFNO0lBRXhCLFdBQVc7SUFDWCxJQUFJSCxFQUFFSSxRQUFRLENBQUMsbUJBQW1CLE9BQU9sQixZQUFZLENBQUMsaUJBQWlCO0lBQ3ZFLElBQUljLEVBQUVJLFFBQVEsQ0FBQywyQkFBMkJKLE1BQU0saUJBQzlDLE9BQU9kLFlBQVksQ0FBQyx1QkFBdUI7SUFFN0MsVUFBVTtJQUNWLE9BQU9JO0FBQ1QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9vZG9vLWludmVudG9yeS1zY2FubmVyLy4vbGliL29kb29QcmVzZXRzLnRzPzEyOTMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gL2xpYi9vZG9vUHJlc2V0cy50c1xyXG5leHBvcnQgdHlwZSBIb3N0UHJlc2V0ID0geyB1cmw6IHN0cmluZzsgZGI6IHN0cmluZzsgZGVmYXVsdExvY2F0aW9uSWQ/OiBudW1iZXIgfTtcclxuXHJcbmV4cG9ydCBjb25zdCBIT1NUX1BSRVNFVFM6IFJlY29yZDxzdHJpbmcsIEhvc3RQcmVzZXQ+ID0ge1xyXG4gICdtb2JvcGx1cy5jby5ueic6IHtcclxuICAgIHVybDogJ2h0dHBzOi8vbW9ib3BsdXMuY28ubnonLFxyXG4gICAgZGI6ICdvZG9vJyxcclxuICAgIGRlZmF1bHRMb2NhdGlvbklkOiAxLCAvLyBUT0RPOiDmm7/mjaLmiJDnnJ/lrp4gSW50ZXJuYWwg5bqT5L2NSURcclxuICB9LFxyXG4gICdyZXBhaXIucmF5dGVjaC5jby5ueic6IHtcclxuICAgIHVybDogJ2h0dHBzOi8vcmVwYWlyLnJheXRlY2guY28ubnonLFxyXG4gICAgZGI6ICdkYi1yYXl0ZWNoLXJlcGFpcicsXHJcbiAgICBkZWZhdWx0TG9jYXRpb25JZDogMSwgLy8gVE9ETzog5pu/5o2i5oiQ55yf5a6eIEludGVybmFsIOW6k+S9jUlEXHJcbiAgfSxcclxufTtcclxuXHJcbi8vIOeOr+Wig+WPmOmHj+WFnOW6le+8muWcqOacjeWKoeWZqOS4iuiuvue9riBPRE9PX1VSTCAvIE9ET09fRELvvIjku6Xlj4rlj6/pgIkgT0RPT19MT0NBVElPTl9JRO+8iVxyXG5leHBvcnQgY29uc3QgRU5WX0ZBTExCQUNLOiBIb3N0UHJlc2V0IHwgdW5kZWZpbmVkID1cclxuICBwcm9jZXNzLmVudi5PRE9PX1VSTCAmJiBwcm9jZXNzLmVudi5PRE9PX0RCXHJcbiAgICA/IHtcclxuICAgICAgICB1cmw6IHByb2Nlc3MuZW52Lk9ET09fVVJMLFxyXG4gICAgICAgIGRiOiBwcm9jZXNzLmVudi5PRE9PX0RCLFxyXG4gICAgICAgIGRlZmF1bHRMb2NhdGlvbklkOiBOdW1iZXIocHJvY2Vzcy5lbnYuT0RPT19MT0NBVElPTl9JRCB8fCAwKSB8fCB1bmRlZmluZWQsXHJcbiAgICAgIH1cclxuICAgIDogdW5kZWZpbmVkO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJlc29sdmVQcmVzZXQoaG9zdFJhdz86IHN0cmluZyk6IEhvc3RQcmVzZXQgfCB1bmRlZmluZWQge1xyXG4gIGNvbnN0IGggPSAoaG9zdFJhdyB8fCAnJylcclxuICAgIC50b0xvd2VyQ2FzZSgpXHJcbiAgICAucmVwbGFjZSgvXnd3d1xcLi8sICcnKVxyXG4gICAgLnNwbGl0KCc6JylbMF07IC8vIOWOu+err+WPo1xyXG5cclxuICAvLyDlrrnlv43lrZDln58v5LqM57qn5Z+fXHJcbiAgaWYgKGguZW5kc1dpdGgoJ21vYm9wbHVzLmNvLm56JykpIHJldHVybiBIT1NUX1BSRVNFVFNbJ21vYm9wbHVzLmNvLm56J107XHJcbiAgaWYgKGguZW5kc1dpdGgoJ3JlcGFpci5yYXl0ZWNoLmNvLm56JykgfHwgaCA9PT0gJ3JheXRlY2guY28ubnonKVxyXG4gICAgcmV0dXJuIEhPU1RfUFJFU0VUU1sncmVwYWlyLnJheXRlY2guY28ubnonXTtcclxuXHJcbiAgLy8g5Zue6YCA5Yiw546v5aKD5Y+Y6YePXHJcbiAgcmV0dXJuIEVOVl9GQUxMQkFDSztcclxufVxyXG4iXSwibmFtZXMiOlsiSE9TVF9QUkVTRVRTIiwidXJsIiwiZGIiLCJkZWZhdWx0TG9jYXRpb25JZCIsIkVOVl9GQUxMQkFDSyIsInByb2Nlc3MiLCJlbnYiLCJPRE9PX1VSTCIsIk9ET09fREIiLCJOdW1iZXIiLCJPRE9PX0xPQ0FUSU9OX0lEIiwidW5kZWZpbmVkIiwicmVzb2x2ZVByZXNldCIsImhvc3RSYXciLCJoIiwidG9Mb3dlckNhc2UiLCJyZXBsYWNlIiwic3BsaXQiLCJlbmRzV2l0aCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/odooPresets.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Finventory%2Froute&page=%2Fapi%2Finventory%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Finventory%2Froute.ts&appDir=C%3A%5Cworking%5Cnext.js%5Codoo-scanner%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5Cworking%5Cnext.js%5Codoo-scanner&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();