"use strict";(()=>{var e={};e.id=500,e.ids=[500],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2927:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>b,requestAsyncStorage:()=>l,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>h});var o={};r.r(o),r.d(o,{GET:()=>u});var a=r(9303),s=r(8716),n=r(670),d=r(7070),c=r(4405);async function i(e,t,r,o){let a=await fetch(`${e}${t}`,{method:"POST",headers:{"Content-Type":"application/json",cookie:o},body:JSON.stringify({jsonrpc:"2.0",id:Date.now(),method:"call",params:r}),cache:"no-store"});return await a.json().catch(()=>({}))}async function u(e){try{let t=e.nextUrl.searchParams.get("code")?.trim();if(!t)return d.NextResponse.json({error:"code required"},{status:400});let r=e.cookies,o=e.headers.get("x-forwarded-host")||e.headers.get("host")||void 0,a=(0,c.jm)(o),s=r.get("od_base")?.value||a?.url||e.nextUrl.searchParams.get("baseUrl")||void 0,n=r.get("od_db")?.value||a?.db||e.nextUrl.searchParams.get("dbName")||void 0,u=r.get("od_session")?.value,p=Number(r.get("od_company")?.value||0)||void 0;if(!s||!n||!u)return d.NextResponse.json({error:"未登录"},{status:401});let l=`session_id=${u}`,h={};p&&(h.company_id=p,h.allowed_company_ids=[p]);let m=await i(s,"/web/dataset/call_kw",{model:"product.product",method:"search_read",args:[[["barcode","=",t]],["id","name","barcode","default_code","qty_available","free_qty"]],kwargs:{limit:1,context:h}},l),v=m?.result?.[0]||null;return d.NextResponse.json({product:v,companyId:p})}catch(e){return d.NextResponse.json({error:e?.message||"查询失败"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/product/route",pathname:"/api/product",filename:"route",bundlePath:"app/api/product/route"},resolvedPagePath:"C:\\working\\next.js\\odoo-inventory-scanner\\app\\api\\product\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:l,staticGenerationAsyncStorage:h,serverHooks:m}=p,v="/api/product/route";function b(){return(0,n.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:h})}},4405:(e,t,r)=>{r.d(t,{jm:()=>s});let o={"moboplus.co.nz":{url:"https://moboplus.co.nz",db:"odoo",defaultLocationId:1},"repair.raytech.co.nz":{url:"https://repair.raytech.co.nz",db:"db-raytech-repair",defaultLocationId:1}},a=process.env.ODOO_URL&&process.env.ODOO_DB?{url:process.env.ODOO_URL,db:process.env.ODOO_DB,defaultLocationId:Number(process.env.ODOO_LOCATION_ID||0)||void 0}:void 0;function s(e){let t=(e||"").toLowerCase().replace(/^www\./,"").split(":")[0];return t.endsWith("moboplus.co.nz")?o["moboplus.co.nz"]:t.endsWith("repair.raytech.co.nz")||"raytech.co.nz"===t?o["repair.raytech.co.nz"]:a}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[276,972],()=>r(2927));module.exports=o})();